<!-- secondary nav -->
<ul id="submenu">

{% for nav_entry in navbar_list.qsdTree %}
  <li class="divsecondarynavlink {% if nav_entry.entry.indent %}indent{% endif %}"> 
    {% if nav_entry.entry.is_link %}
      <a href="{{ nav_entry.entry.makeUrl }}"
        title="Click for `{{ nav_entry.entry.makeTitle }}'">
        {{ nav_entry.entry.makeTitle }}
      </a>
    {% else %}
        {{ nav_entry.entry.makeTitle }}
    {% endif %}
 </li>
{% endfor %}
</ul>

{% if request.user.isAdministrator %}
<ul id="navbar_admin">
{% for nav_entry in navbar_list.qsdTree %}
  <li class="divsecondarynavlink {% if nav_entry.entry.indent %}indent{% endif %}{% if nav_entry.has_bits %} movable{% endif %} " id="nav_entry__{{nav_entry.entry.id}}"> 
{% if nav_entry.has_bits %}
<tt>
<span class="bullet">- </span>{{ nav_entry.entry.makeTitle }}
<span id="nav_entry__control__{{nav_entry.entry.id}}">
<a href="/navbar/edit.scm?new_url={{ request.path }}&amp;navbar_id={{ nav_entry.entry.id }}&amp;node_id={{ navbar_list.entry.node.id }}&amp;action=up">[+]</a>
<a href="/navbar/edit.scm?new_url={{ request.path }}&amp;navbar_id={{ nav_entry.entry.id }}&amp;node_id={{ navbar_list.entry.node.id }}&amp;action=down">[-]</a>
</span>

<a href="/navbar/edit.scm?new_url={{ request.path }}&amp;navbar_id={{ nav_entry.entry.id }}&amp;node_id={{ navbar_list.entry.node.id }}&amp;action=delete" onclick="delete_navbar({{nav_entry.entry.id}}); return false;">[X]</a>
</tt>
{% endif %}
 </li>
{% endfor %}

{% if navbar_list.has_edit_bits %}

<li class="divsecondarynavlink">

<form name="shiftform" method="post" action="/navbar/edit.scm">
Create a new entry:
<input type="hidden" name="new_url" value="{{ request.path }}" />
<input type="hidden" name="section" value="{{ navbar_list.section }}" />
<input type="hidden" name="node_id" value="{{ navbar_list.node.id }}" />
<input type="hidden" name="navbar_id" value="" />
<input type="hidden" name="action" value="new" />
<input name="text" value="Page Name" size="20" />
<input name="url" value="PageURL.html" size="20" />
<select name="indent">
<option value="False">Standard</option>
<option value="True">Indented</option>
</select>
<select name="child_node">
<option value="{{ navbar_list.node.id }}">Node</option>
{% for child_node in navbar_list.node.children %}
<option value="{{ child_node.id }}">{{child_node.name }}</option>
{% endfor %}
</select>
<input name="submit" value="Create!" type="Submit" />
</form>
</li>

<script type="text/javascript">
<!--
dragndrop = function() {
    var Dom = YAHOO.util.Dom;
    var DDM = YAHOO.util.DragDropMgr;

{% for nav_entry in navbar_list.qsdTree %}{% if nav_entry.has_bits %}
    new YAHOO.example.DDList("nav_entry__{{ nav_entry.entry.id }}");
    document.getElementById('nav_entry__control__{{nav_entry.entry.id}}').innerHTML = '';{% endif %}{% endfor %}
    DDM.mode = 0;
};

YAHOO.util.Event.addListener(window, "load", dragndrop);



function delete_navbar(navbar_id) {
   if (!confirm("Are you SURE you want to delete this navbar?")) {
      return;
   }

   var callback = {
    success:function(o) {
       document.getElementById('nav_entry__'+o.argument.nav_entry_id).innerHTML = '';
       document.getElementById('nav_entry__'+o.argument.nav_entry_id).style.display = 'none';
    },
    failure:function(o) {},
    argument: {nav_entry_id: navbar_id}};

   sUrl = '/navbar/edit.scm?new_url={{request.path}}&navbar_id='+navbar_id+'&node_id=&action=delete'

   var request = YAHOO.util.Connect.asyncRequest('GET',sUrl,callback);

}

var handleSuccess = function(o){
   if (o.responseText !== undefined && o.responseText.length > 0) {
      alert(o.responseText);

   }
};

var callback =
{
  success:function(o) {},
  failure:function(o) {},
  argument: {}
};

function move_seq(new_seq) {

   sUrl = '?ajax_movepage&seq='+new_seq;
   //   alert(sUrl);
   var request = YAHOO.util.Connect.asyncRequest('GET',sUrl,callback);
}


// register module
ESP.registerAdminModule({
name: "Navbar",
content_target: "navbar_admin"
});

//-->
</script>

<style type="text/css" media="screen">
#navbar_admin {
margin: 0; padding: 0;
font-size: smaller;
}

#navbar_admin li {
list-style-type: none;
}

#navbar_admin .movable {
  cursor: move;
  border: 1px solid transparent;
}

#navbar_admin li.movable:hover {
    border: 1px solid #aaa;
}

</style>

{% endif %}
</ul>
{% endif %}
