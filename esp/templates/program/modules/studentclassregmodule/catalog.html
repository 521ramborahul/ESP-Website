
{% extends "main.html" %}

{% block title %}{{program.niceName}}{% endblock %}

{% block xtrajs %}
{{ block.super }}
<script type="text/javascript">
<!--
  function submit_prereg(clsid) {
     // prereg for a class
     document.getElementById('submitbutton'+clsid).setAttribute("class", "addbutton_disabled");
     return true;
  }

  function submit_override_prereg(clsid) {
     // prereg for a class
     if (confirm('Are you sure you want to override this block?') &&
         confirm('Are you really sure?!?')) {
        document.getElementById('submitbutton'+clsid).disabled = true;
        return true;
     }
     return false;
  }
//-->

function swap_visible(div_id) {
	var div = document.getElementById(div_id);
	if (div.style.display == 'none') {
		div.style.display = '';
	} else {
		div.style.display = 'none';
	}
}

var student_grade = "{{ user.getGrade }}"; {% comment %} Convert from int to string to int in case user.getGrade returns null or errors {% endcomment %}

if (student_grade != "") {
  student_grade = parseInt(student_grade);
}

function hideClassesOutOfGradeRange(stu_grade) {
  if (student_grade == "") {
    return;
  }

  mins = {};
  maxes = {};

  var grade;
  var clsid;
  var arr;
  arr = document.getElementsByClassName("grademin");
  for (var grademin in arr) {
    var grademin_node = arr[grademin];
    if (grademin_node.id) {
      grade = parseInt(grademin_node.innerHTML);
      clsid = grademin_node.id.split("_")[0];
      mins[clsid] = grade;
    }
  }

  arr = document.getElementsByClassName("grademax");
  for (var grademax in arr) {
    grademax_node = arr[grademax];
    if (grademax_node.id) {
      grade = parseInt(grademax_node.innerHTML);
      clsid = grademax_node.id.split("_")[0];
      maxes[clsid] = grade;
    }
  }

  arr = document.getElementsByClassName("classcontent");
  for (var clsnum in arr) {
    cls = arr[clsnum];
    if (cls.id) {
      clsid = cls.id.split("_")[0];
      if (stu_grade < mins[clsid] || stu_grade > maxes[clsid]) {
        cls.style.display = 'none';
      }
    }
  }

  arr = document.getElementsByClassName("classdetails");
  for (var clsnum in arr) {
    cls = arr[clsnum];
    if (cls.id) {
      clsid = cls.id.split("_")[0];
      if (stu_grade < mins[clsid] || stu_grade > maxes[clsid]) {
        cls.style.display = 'none';
      }
    }
  }

  arr = document.getElementsByClassName("classregbuttons");
  for (var clsnum in arr) {
    cls = arr[clsnum];
    if (cls.id) {
      clsid = cls.id.split("_")[0];
      if (stu_grade < mins[clsid] || stu_grade > maxes[clsid]) {
        cls.style.display = 'none';
      }
    }
  }

  return [mins, maxes];
}

</script>
{% endblock %}

{% load subsection %}

{% block subsection %}
{% autoescape off %}{{ "Course Catalog"|subsection }}{% endautoescape %}
{% endblock %}

{% block stylesheets %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="/media/styles/catalog.css" />
{% endblock %}

{% block content %}
<br />

<h1>
    {{ program.niceName }} <br /> 
        Course Catalog
</h1>

{% if timeslot %}
<h2 style="text-align: center;">
Viewing classes for: {{ timeslot.friendly_name }}
</h2>
{% endif %}
{% if request.user.onsite_local %}

{% if not request.GET.filter %}
<h2 style="text-align: center;">
<a href="{{request.path}}?filter=True">Filter out invalid classes</a>
</h2>
{% else %}
<h2 style="text-align: center;">
<a href="{{request.path}}">Show all classes</a>
</h2>
{% endif %}
{% endif %}

<div id="catalog">

<table align="center" style="text-align: center; margin: auto;" width="60%" border="0">
 <tr>
  <th colspan="2">
   <a name="top"></a>Jump to Categories
  </th>
 </tr>

{% for category in categories %}
{% if forloop.counter0|divisibleby:2 %}
<tr>{% endif %}
  <td style="width: 50%; vertical-align: top;" valign="top" align="center">

    <a href="#cat{{ category.id }}" title="Click to skip down to `{{ category.category }}'">
              {{category.category}}
    </a>
  </td>
 {% if forloop.counter|divisibleby:2 %}
</tr>{% endif %} 
{% endfor %}
{% if not categories|length|divisibleby:2 %}
</tr>
{% endif %}
</table>

{% load render_qsd %}
{% render_inline_qsd program.anchor "learn:catalog" request.user %}

{% load class_render %}
{% for class in classes %}

{% ifchanged class.category_id %}<hr size="1"/>

    <a name="cat{{class.category_id}}"></a>
      <p style="font-size: 1.2em;" class="category">
         {{ class.category.category }}
      </p>
{% if request.user.onsite_local %}
{% if not request.GET.filter %}
<h2 style="text-align: center;">
<a href="{{request.path}}?filter=True">Filter out invalid classes</a>
</h2>
{% else %}
<h2 style="text-align: center;">
<a href="{{request.path}}">Show all classes</a>
</h2>
{% endif %}
{% endif %}
      <p class="linktop">
         <a href="#top">[ Return to Category List ]</a>
      </p> {% endifchanged %}

{% render_class class request.user prereg_url request.GET.filter timeslot request %}

<br />
{% endfor %}
</div>

<script language="JavaScript">
hideClassesOutOfGradeRange(student_grade);
</script>

{% endblock %}
